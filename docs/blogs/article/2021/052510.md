---
title: æ–‡ä»¶ä¸‹è½½
date: 2021-05-25
tags:
  - æŠ¥è¡¨ä¸‹è½½
categories:
  - PC
author: 11æœˆ
---

**æœ¬æ–‡æ—¨åœ¨è®°å½•é¢˜ä¸»æ¬ç –é€”ä¸­æ‰€é‡æ‰€æƒ³ã€‚**
<Boxx />

## å‰è¨€èƒŒæ™¯

æœ€è¿‘æ¥æ‰‹äº†æŸæ´»åŠ¨ç»Ÿè®¡æŠ¥è¡¨å¹³å°ä¸è¿è¥å¹³å°çš„éƒ¨åˆ†éœ€æ±‚ï¼Œå…¶ä¸­åŒ…å« excel ä¸‹è½½ç­‰ï¼Œæƒ³èµ·æ¥ä¹‹å‰åœ¨è¥é”€ç»„æ—¶å¼€å‘çµçŠ€å¹³å°é‡åˆ°çš„ excelã€scv ä¸‹è½½åœºæ™¯ï¼Œæ—¶éš”è®¸ä¹…ä¹Ÿç®—æ˜¯è¡¥ä¸Šå½“æ—¶æƒ³å†™ä½†ä¸€ç›´æœªå†™çš„å‘ã€‚

## è§£å†³æ–¹æ¡ˆ

ä¸€èˆ¬æ¥è®²ä¸‹è½½æ–‡ä»¶å¸¸ç”¨çš„(ç›®å‰æˆ‘ç”¨è¿‡çš„:)æœ‰ä¸¤ç§æ–¹å¼:

- é€šè¿‡ download æ¥å£å‘ŠçŸ¥åç«¯éœ€è¦ä¸‹è½½çš„æ•°æ®ï¼Œç”±åç«¯ç”Ÿæˆæ–‡ä»¶å­˜å‚¨åè¿”å›ç»™å‰ç«¯ç›¸åº”çš„ä¸‹è½½ urlï¼Œå‰ç«¯é€šè¿‡è¯¥ url è¿›è¡Œä¸‹è½½ã€‚(æ¸…åˆ†æŠ¥è¡¨ä½¿ç”¨è¯¥æ–¹å¼ï¼Œåç«¯æ¯æ—¥ä¼šæœ‰å®šæ—¶ä»»åŠ¡äº§ç”Ÿæ‰€éœ€ä¸‹è½½æ–‡ä»¶å¹¶å°†å¤„ç†ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‰ç«¯è¯·æ±‚æ—¶ç›´æ¥ä»ç¼“å­˜è·å–) æœ¬æ¬¡ä¸åœ¨èµ˜è¿°ç›¸å…³ç»†èŠ‚ã€‚

- é€šè¿‡ download æ¥å£å‘ŠçŸ¥åç«¯éœ€è¦ä¸‹è½½çš„æ•°æ®ï¼Œåç«¯è¿”å›æ–‡ä»¶æµåé€šè¿‡[Blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)ï¼Œä»¥åŠåˆ›å»º[å¯¹è±¡ URL](https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL)ç­‰æ“ä½œæ¥å®ç°ä¸‹è½½ã€‚

```
// ä»¥ä¸‹ä¸ºç®€å•ğŸŒ°:
function downloadFile(data, fileName) {
    let blob = new Blob([data], {
        type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8'
    })

    if (window.navigator.msSaveBlob) {
        window.navigator.msSaveBlob(blob, fileName || 'pub.xlsx')
        return false
    }

    const aEl = document.createElement('a)
    const body = document.querySelector('body')
    aEl.download = fileName || 'pub.xlsl'
    aEl.style.display = 'none'
    aEl.href = URL.createObjectURL(blob)
    body.appendChild(aEl)
    aEl.click()
    body.removeChild(aEl)
    // é‡Šæ”¾ URLå¯¹è±¡
    URL.revokeObjectURL(aEl.href)
}


```

:::warning

- åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¥å£å“åº”çš„æ•°æ®ç±»å‹æ˜¯ DOMStringã€‚ç”±äºæœåŠ¡ç«¯è¿”å›çš„æ˜¯æ–‡ä»¶æµï¼Œå½“æˆ‘ä»¬ä¸è®¾ç½®[responseType](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseType)ä¸º blob æ—¶ï¼Œä¼šå‘ç°ä¸‹è½½çš„æ–‡ä»¶å‘ç”Ÿå¼‚å¸¸ã€‚

- è¯¥æ–¹å¼åœ¨ IE ä¸‹éœ€ä½¿ç”¨[msSaveBlob](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/msSaveBlob)è¿›è¡Œå…¼å®¹å¤„ç†ã€‚

- ä¸åç«¯çº¦å®šè¿”å›ä¿¡æ¯ typeï¼Œç”¨æ¥åˆ¤æ–­å½“å‰å“åº”çŠ¶æ€ã€‚å½“æ¥å£å“åº”å¼‚å¸¸æ—¶ï¼Œç”±äºåç«¯è¿”å›çš„ä¿¡æ¯æ˜¯ Blobï¼Œå…¶åŒ…å«çš„æ­£å¸¸é”™è¯¯ä¿¡æ¯æ— æ³•æ•è·ï¼Œéœ€è¦å…ˆå¤„ç†ä¸º JSON æ ¼å¼ã€‚

:::

#### æ­£å¸¸è¿”å›:

![](https://cyi113.oss-cn-shanghai.aliyuncs.com/static/download_msg1.png)

#### å¼‚å¸¸è¿”å›:

![](https://cyi113.oss-cn-shanghai.aliyuncs.com/static/download_msg2.png)

#### å¼‚å¸¸è¿”å›æŠ¥æ–‡:

![](https://cyi113.oss-cn-shanghai.aliyuncs.com/static/download_msg3.png)

å¤„ç†å¼‚å¸¸è¿”å›æŠ¥æ–‡[FileReader](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader):

```
// ç®€å•ğŸŒ°:
function onClick() {
    // è¯·æ±‚è¿”å› dataï¼Œåˆ¤æ–­è¿”å›æ•°æ®æ˜¯å¦æ­£å¸¸
    if (data.type === 'application/json') {
        handleErrorTip(data)
        return false
    }

    // download
}

function handleErrorTip(data) {
    const fileReader = new FileReader()
    fileReader.onload = () => {
        const result = JSON.parse(fileReader.result)
        this.$message.error(result.message)
    }

    fileReader.readAsText(data, 'utf-8')
}
```

## æ€»ç»“

åç»­ä¼šæ›´æ–°å¤§æ–‡ä»¶ä¸‹è½½ç›¸å…³ç»†èŠ‚ï¼Œæš‚æ—¶å…ˆå¼€ä¸ªå‘ã€‚

#### å‚è€ƒä¿¡æ¯

- [FileSaver](https://github.com/eligrey/FileSaver.js)

- [Blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)
- [å¯¹è±¡ URL](https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL)
- [msSaveBlob](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/msSaveBlob)
- [FileReader](https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader)
- [responseType](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseType)
- [å¸¸è§ MIME ç±»å‹åˆ—è¡¨](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types)

- [å…¶ä»–èµ„æ–™](https://zhuanlan.zhihu.com/p/97768916)
